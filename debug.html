<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PageMarker Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .debug-info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>🔧 PageMarker Debug Test</h1>
    
    <div class="debug-info">
        <h2>Extension Status</h2>
        <div id="extensionStatus" class="status warning">Checking...</div>
        <div id="pageMarkerStatus" class="status warning">Checking...</div>
        <div id="toolbarStatus" class="status warning">Checking...</div>
    </div>
    
    <div class="debug-info">
        <h2>Test Controls</h2>
        <button onclick="testToggle()">Test Toggle Annotation</button>
        <button onclick="testKeyboard()">Test Keyboard Shortcut (Alt+D)</button>
        <button onclick="checkConsole()">Check Console for Errors</button>
        <button onclick="reloadPage()">Reload Page</button>
    </div>
    
    <div class="debug-info">
        <h2>Instructions</h2>
        <ol>
            <li>Make sure the PageMarker extension is installed and enabled</li>
            <li>Click "Test Toggle Annotation" to activate the extension</li>
            <li>You should see a floating toolbar appear on the page</li>
            <li>Try drawing with the pen tool</li>
            <li>Check the browser console (F12) for any error messages</li>
        </ol>
    </div>
    
    <div class="debug-info">
        <h2>Expected Behavior</h2>
        <ul>
            <li>✅ Extension should load without errors</li>
            <li>✅ PageMarker object should be available in window.pageMarker</li>
            <li>✅ Toggle should show/hide the floating toolbar</li>
            <li>✅ Drawing tools should work when toolbar is visible</li>
            <li>✅ Keyboard shortcuts should work (Alt+D to toggle)</li>
        </ul>
    </div>

    <script>
        function updateStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }
        
        function checkExtensionStatus() {
            // Check if extension is loaded
            if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.id) {
                updateStatus('extensionStatus', '✅ Chrome extension API available', 'success');
            } else {
                updateStatus('extensionStatus', '❌ Chrome extension API not available', 'error');
            }
            
            // Check if PageMarker is loaded
            if (window.pageMarker) {
                updateStatus('pageMarkerStatus', '✅ PageMarker object found', 'success');
                updateStatus('toolbarStatus', `Toolbar visible: ${window.pageMarker.toolbar ? window.pageMarker.toolbar.style.display !== 'none' : 'No toolbar'}, Active: ${window.pageMarker.isActive}`, 'success');
            } else {
                updateStatus('pageMarkerStatus', '❌ PageMarker object not found', 'error');
                updateStatus('toolbarStatus', '❌ No PageMarker instance', 'error');
            }
        }
        
        function testToggle() {
            if (window.pageMarker) {
                console.log('Testing toggle...');
                window.pageMarker.toggle();
                setTimeout(checkExtensionStatus, 100);
            } else {
                alert('PageMarker not found! Check console for errors.');
            }
        }
        
        function testKeyboard() {
            console.log('Simulating Alt+D keypress...');
            const event = new KeyboardEvent('keydown', {
                key: 'd',
                altKey: true,
                bubbles: true
            });
            document.dispatchEvent(event);
        }
        
        function checkConsole() {
            console.log('=== PageMarker Debug Info ===');
            console.log('window.pageMarker:', window.pageMarker);
            console.log('Chrome extension API:', typeof chrome !== 'undefined' ? 'Available' : 'Not available');
            if (window.pageMarker) {
                console.log('PageMarker active:', window.pageMarker.isActive);
                console.log('Toolbar element:', window.pageMarker.toolbar);
                console.log('Canvas element:', window.pageMarker.canvas);
            }
        }
        
        function reloadPage() {
            window.location.reload();
        }
        
        // Check status on load
        window.addEventListener('load', () => {
            setTimeout(checkExtensionStatus, 1000);
        });
        
        // Check status every 2 seconds
        setInterval(checkExtensionStatus, 2000);
    </script>
</body>
</html>
